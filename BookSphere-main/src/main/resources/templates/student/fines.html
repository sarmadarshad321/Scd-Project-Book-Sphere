<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Fines - BookSphere</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f3f4f6;
            min-height: 100vh;
        }
        
        /* Navbar */
        .navbar {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .navbar-nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .navbar-nav a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 8px;
            transition: background 0.3s;
        }
        
        .navbar-nav a:hover, .navbar-nav a.active {
            background: rgba(255,255,255,0.2);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .btn-logout {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
            transition: background 0.3s;
        }
        
        .btn-logout:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Main Content */
        .main-content {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .page-header {
            margin-bottom: 25px;
        }
        
        .page-header h1 {
            color: #1f2937;
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .page-header p {
            color: #6b7280;
        }
        
        /* Summary Card */
        .summary-card {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .summary-card.clear {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .summary-info h2 {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .summary-amount {
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .summary-icon {
            font-size: 4rem;
            opacity: 0.3;
        }
        
        /* Section */
        .section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .section-header {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            padding: 20px 25px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .section-header.paid {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .section-title {
            font-size: 1.2rem;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-body {
            padding: 25px;
        }
        
        /* Fine Cards */
        .fine-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .fine-card {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 10px;
            border-left: 4px solid #ef4444;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .fine-card.paid {
            border-left-color: #10b981;
        }
        
        .fine-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .fine-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .fine-icon.paid {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .fine-details {
            flex: 1;
        }
        
        .fine-book {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
        }
        
        .fine-reason {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .fine-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .meta-item {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        .meta-item strong {
            color: #374151;
        }
        
        .fine-amount-section {
            text-align: right;
            min-width: 120px;
        }
        
        .fine-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ef4444;
        }
        
        .fine-amount.paid {
            color: #10b981;
            text-decoration: line-through;
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 5px;
        }
        
        .status-badge.pending {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-badge.paid {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-badge.partial {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-badge.waived {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .empty-state h3 {
            color: #374151;
            margin-bottom: 10px;
        }
        
        /* Info Box */
        .info-box {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px 20px;
            margin-top: 20px;
            color: #0369a1;
            font-size: 0.9rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }
            
            .navbar-nav {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .summary-card {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .fine-card {
                flex-direction: column;
            }
            
            .fine-amount-section {
                text-align: left;
                margin-top: 15px;
            }
            
            .fine-meta {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            üìö BookSphere
        </div>
        <div class="navbar-nav">
            <a th:href="@{/student/dashboard}">Dashboard</a>
            <a th:href="@{/student/books}">Browse Books</a>
            <a th:href="@{/student/my-books}">My Books</a>
            <a th:href="@{/student/reservations}">Reservations</a>
            <a th:href="@{/student/fines}" class="active">Fines</a>
            <a th:href="@{/student/profile}">Profile</a>
        </div>
        <div class="user-info">
            <span th:text="${user.fullName}">Student Name</span>
            <form th:action="@{/logout}" method="post" style="margin: 0;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit" class="btn-logout">Logout</button>
            </form>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="page-header">
            <h1>üí∞ My Fines</h1>
            <p>View and track your library fines</p>
        </div>

        <!-- Summary Card -->
        <div class="summary-card" th:classappend="${totalPending == 0 ? 'clear' : ''}">
            <div class="summary-info">
                <h2 th:text="${totalPending == 0 ? 'Great job!' : 'Total Outstanding Fines'}">Total Outstanding Fines</h2>
                <div class="summary-amount" th:text="${totalPending == 0 ? 'No fines due!' : '$' + #numbers.formatDecimal(totalPending, 1, 2)}">$0.00</div>
            </div>
            <div class="summary-icon" th:text="${totalPending == 0 ? '‚úì' : 'üí∞'}">üí∞</div>
        </div>

        <!-- Pending Fines -->
        <div class="section" th:if="${!#lists.isEmpty(pendingFines)}">
            <div class="section-header">
                <h2 class="section-title">‚ö†Ô∏è Pending Fines</h2>
            </div>
            <div class="section-body">
                <div class="fine-list">
                    <div th:each="fine : ${pendingFines}" class="fine-card">
                        <div class="fine-icon">üí∞</div>
                        <div class="fine-details">
                            <h3 class="fine-book" th:text="${fine.transaction.book.title}">Book Title</h3>
                            <p class="fine-reason" th:text="${fine.reason ?: 'Overdue fine'}">Overdue fine</p>
                            <div class="fine-meta">
                                <span class="meta-item">
                                    <strong>Due Date:</strong> 
                                    <span th:text="${#temporals.format(fine.transaction.dueDate, 'MMM dd, yyyy')}">Jan 15, 2024</span>
                                </span>
                                <span class="meta-item">
                                    <strong>Created:</strong> 
                                    <span th:text="${#temporals.format(fine.createdAt, 'MMM dd, yyyy')}">Jan 20, 2024</span>
                                </span>
                            </div>
                        </div>
                        <div class="fine-amount-section">
                            <div class="fine-amount" th:text="'$' + #numbers.formatDecimal(fine.amount - fine.paidAmount, 1, 2)">$5.00</div>
                            <span class="status-badge pending">Pending</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-box">
                    ‚ÑπÔ∏è Please visit the library desk to pay your outstanding fines. You may be restricted from borrowing new books until fines are cleared.
                </div>
            </div>
        </div>

        <!-- All Fines History -->
        <div class="section">
            <div class="section-header paid">
                <h2 class="section-title">üìú Fine History</h2>
            </div>
            <div class="section-body">
                <div th:if="${#lists.isEmpty(fines)}" class="empty-state">
                    <div class="empty-state-icon">‚ú®</div>
                    <h3>No fines</h3>
                    <p>You have a clean record! Keep returning books on time.</p>
                </div>
                
                <div th:if="${!#lists.isEmpty(fines)}" class="fine-list">
                    <div th:each="fine : ${fines}" class="fine-card" th:classappend="${fine.status.name() == 'PAID' ? 'paid' : ''}">
                        <div class="fine-icon" th:classappend="${fine.status.name() == 'PAID' ? 'paid' : ''}">
                            <span th:if="${fine.status.name() == 'PAID'}">‚úì</span>
                            <span th:if="${fine.status.name() != 'PAID'}">üí∞</span>
                        </div>
                        <div class="fine-details">
                            <h3 class="fine-book" th:text="${fine.transaction.book.title}">Book Title</h3>
                            <p class="fine-reason" th:text="${fine.reason ?: 'Overdue fine'}">Overdue fine</p>
                            <div class="fine-meta">
                                <span class="meta-item">
                                    <strong>Amount:</strong> 
                                    <span th:text="'$' + #numbers.formatDecimal(fine.amount, 1, 2)">$5.00</span>
                                </span>
                                <span th:if="${fine.paidAmount > 0}" class="meta-item">
                                    <strong>Paid:</strong> 
                                    <span th:text="'$' + #numbers.formatDecimal(fine.paidAmount, 1, 2)">$3.00</span>
                                </span>
                                <span class="meta-item">
                                    <strong>Date:</strong> 
                                    <span th:text="${#temporals.format(fine.createdAt, 'MMM dd, yyyy')}">Jan 20, 2024</span>
                                </span>
                            </div>
                        </div>
                        <div class="fine-amount-section">
                            <div class="fine-amount" th:classappend="${fine.status.name() == 'PAID' ? 'paid' : ''}" 
                                 th:text="'$' + #numbers.formatDecimal(fine.amount, 1, 2)">$5.00</div>
                            <span th:if="${fine.status.name() == 'PENDING'}" class="status-badge pending">Pending</span>
                            <span th:if="${fine.status.name() == 'PAID'}" class="status-badge paid">Paid</span>
                            <span th:if="${fine.status.name() == 'PARTIAL'}" class="status-badge partial">Partial</span>
                            <span th:if="${fine.status.name() == 'WAIVED'}" class="status-badge waived">Waived</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
